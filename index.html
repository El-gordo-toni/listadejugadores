<!doctype html >
< html lang = \ " es \"> 
< cabeza >
  < meta charset = \ " utf-8 \" /> 
  < meta nombre = \ " viewport \" contenido = \ " ancho = ancho del dispositivo, escala inicial = 1\ " />  
  <title>Inscripción – Matungo Golf</title>
  < link rel = \ " hoja de estilos \ " href = \ " https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css \ " / >​​​​​​​​ 
  < estilo >
    cuerpo { fondo : #0a0f14 ; color : #e6edf3 }
    .card { fondo : #0f1720 ; borde : 1px sólido #1f2937 }
    .form-control , .form-select { fondo : #0b1320 ; color : #e6edf3 ; color del borde : #1f2937 }
    .btn-primary { fondo : #2a6df4 ; color del borde : #2a6df4 }
    .btn-outline-danger { color del borde : #ef4444 ; color : #ef4444 }
    .btn-outline-danger :hover { fondo : #ef4444 ; color : #fff }
    un { color : #9cc1ff }
  </ estilo >
</ cabeza >
< cuerpo >
< div clase = \ " contenedor py-4 \">  
  < div class = \ " fila g-4 \">  
    < div clase = \ " col-lg-4 \"> 
      < div class = \ " tarjeta p-3 shadow-sm \">   
        <h3 class=\"mb-3\">Anótate a la fecha</h3>
        < form id = " formulario_de_registro " class = " vstack_gap - 2 " autocompletar = " desactivado " novalidar >​​  
          < input class = \ " form-control \" name = \ " full_name \" placeholder = \ " Apellido y nombre \"
   
                 patrón = \ "[ A-Za-zÁÉÍÓÚáéíóúÑñÜü \ s ]+\"
                 title = \ " Solo letras y espacios \" requerido />   
          < input class = \ " form - control \" name = \ " matricula \" placeholder = \ " Número de registro ( opcional )\"
   
                 modo de entrada = \ " numérico \" patrón = \ "\\ d { 1 , 12 }\" longitud máxima = \ " 12 \"
                 title=\"Solo números (1–12 dígitos, opcional)\" />
          <button class=\"btn btn-primary mt-2\" type=\"submit\">Confirmar inscripción</button>
        </form>​​
        Descargar CSV​​​​​​​​​​​​​​​​​  
        Descargar JSON de respaldo​​​​​​​​​​​​​​ 
      </div>​​
    </div>​​

    < div clase = \ " col-lg-8 \"> 
      < div class = \ " tarjeta p-3 shadow-sm \">   
        < div class = \ " d-flex align-items-center justify-content-between \">   
          <h3 class=\"m-0\">Inscriptos (en tiempo real)</h3>
          0​​​​​​​​​​​​​​​​​​  
        </div>​​
        < div class = \ " tabla-responsive mt-3 \">  
          < tabla clase = \ " tabla tabla-oscura tabla-rayada alinear-medio \" id = \ " tablaJugadores \">    
            < cabeza >
              < tr >
                < th > # </ th >
                <th>Apellido y nombre</th>
                < th > Matriz </ th >
                < th > Hora </ th >
                < th > </ th >
              </tr>​​
            </ cabeza >
            < cuerpo > </ cuerpo >
          </tabla>​​
        </div>​​
      </div>​​
    </div>​​
  </div>​​
</div>​​

< script src = " https://cdn.socket.io/4.7.5/socket.io.min.js " > </script>​​​​​​​​ 
< script >
  constante socket = io ();
  const tbody = document .querySelector ( '#playersTable tbody' ) ;
  const count = document.getElementById ( 'count ' ) ;

  función renderRow ( p ){
 
    const tr = document.createElement ( ' tr' ) ;
    tr. id = 'fila-' +p. id ;
    tr. innerHTML = `
${       p.id }
      <td> ${escapeHtml(p.nombre_completo)} </td>
      <td> ${escapeHtml(p.matricula)} </td>
      <td> ${p.created_at} </td>
      <td class=\"text-end\">
        Eliminar​​
      </td>` ;
    devolver tr;
  }

  función escapeHtml ( texto ){
 
    constante map = { '&' : '&' , '<' : '<' , ">' : '>' , '"' : '"' , "'" : ''' };
    devolver (texto || '' ). reemplazar ( /[&<>\"']/g , m => map[m]);
  }

  función refreshCount ( ){
 
    count.textContent = tbody.querySelectorAll ( ' tr' ) .
 length ;
  }

  socket.on ( ' bootstrap' , ( jugadores )=> {
    tbody.innerHTML = ' '
 ;
    jugadores.forEach ( p => tbody.appendChild ( renderRow (p))
 ) ;
    actualizarCount ();
  });

  socket.on ( ' jugador_añadido' , ( p )=> {
    tbody.appendChild ( renderRow ( p ));
    actualizarCount ();
  });

  socket.on ( ' jugador_eliminado' , ( {id} )=> {
    const tr = document.getElementById ( 'fila-' + id );
    si (tr){ tr. eliminar (); }
    actualizarCount ();
  });

  documento .getElementById ( 'formulario de registro' ) . addEventListener ( 'enviar' , async (e)=>{
    e. preventDefault ();
    forma constante = e. objetivo ;
    const payload = Object.fromEntries ( new FormData ( form).entradas ( ))
 ; 

    const nombreRe = /^[A-Za-zÁÉÍÓÚáéíóúÑñÜü\s]+$/ ;
    si ( !carga_útil.nombre_completo || !nombreRe.prueba ( carga_útil.nombre_completo.trim ()
 ) ) {
      alert('Apellido y nombre: solo letras y espacios.');
      devolver ;
    }
    si ( payload.matrícula && ! /^\d{1,12}$/ .test ( payload.matrícula .trim ( )))
 {
      alert('Matrícula (opcional): solo números (1–12 dígitos).');
      devolver ;
    }

    if(!confirm(`Confirmar inscripción de: ${payload.full_name}?`)) return;

    const res = await fetch ( '/signup' , {
 
      método : 'POST' ,
      encabezados : { 'Tipo de contenido' : 'application/json' },
      cuerpo : JSON.stringify (carga
 útil )
    });
    const datos = await res.json ()
 ;
    si (!datos.ok )
 {
      alert(data.error || 'Error al inscribir.');
      devolver ;
    }
    formulario.reset ()
 ;
  });

  función asíncrona removePlayer ( id ){
  
    const pass = prompt ( 'Clave de admin para eliminar:' );
    si (pass === null ) retorna ;
    const res = await fetch ( `/eliminar/ ${id} ` , {
 
      método : 'POST' ,
      encabezados :{ 'Tipo-de-contenido' : 'application/json' },
      cuerpo : JSON.stringify ({ admin_key : pass
 } )
    });
    const datos = await res.json ()
 ;
    si (!datos.ok )
 {
      alert(data.error || 'No se pudo eliminar.');
      devolver ;
    }
  }
</script>​​
</ cuerpo >
</html>
